<head>
  <script src="https://kit.fontawesome.com/95578669af.js" crossorigin="anonymous"></script>
<head>

<body>

<div class="container">
  <div class="row justify-content-center">
    <div class="col-sm-8 my-3">
      <%= form_with url: apps_path, method: :get, class: "d-flex" do %>
        <%= text_field_tag :query,
              params[:query],
              class: "form-control",
              placeholder: "Type a tool name or category"
          %>
        <%= submit_tag "Search", name: "", class: "btn btn-primary" %>
      <% end %>
      <%#replace filter button action with stimulus %>
    </div>
  </div>

  <div class="filters d-flex justify-content-between mb-3">
    <div class="filter_button d-flex flex-grow-1 me-2">
      <%= form_with(url: apps_path, method: :get, local: true) do %>
        <%= select_tag :category_id, options_from_collection_for_select(@categories, :id, :name, params[:category_id]), include_blank: 'All Categories' %>
        <%= submit_tag 'Filter' %>
      <% end %>

    </div>
    <div class="toggle pt-2">
      <% if params[:connections] == "true" %>
        <i class="fa-solid fa-user-group pe-2" style="color: #3282B8">
        <%= link_to "Off", request.params.merge(connections: false), class: "filter_button" %></i>
      <% else %>
        <i class="fa-solid fa-user-group pe-2" style="color: #3282B8">
        <%= link_to "On", request.params.merge(connections: true), class: "filter_button" %></i>
      <% end %>
    </div>

  </div>


  <div class="apps" id="apps_div">
    <% @apps.each do |app| %>
      <div class="app-card">
        <div class="app d-flex justify-content mb-3 align-items-center">

          <%= link_to app_path(app) do %>
            <%= image_tag "notion.png", width: "80px", height: "80px", crop: :fill %>
          <% end %>

          <div class="content-up-down-row d-flex flex-grow-1">
            <div class="name-description flex-column flex-grow-1 justify-content px-3">
              <div class="app-name mt-2 mb-1">
                <%= link_to app.name.truncate(App::NAME_LENGTH), app_path(app), class: "text-decoration-none fw-bold h5" %>
              </div>

              <div class="app-categories small">
                <p> Category: <%= app.categories.map(&:name).join(", ").truncate(App::CATEGORY_LENGTH) %> </p>
                <p> <strong><%= app.votes.where(vote: 1, user: current_user.connections).count %></strong> connections upvoting </p>
              </div>
            </div>

            <div class="up-down p-1 me-1">
              <br>
              <div class="up text-center mb-1">
                <%#= link_to app_votes_path(app, vote: 1), data: { turbo_method: :post } do %>
                <%= button_to app_votes_path(app, vote: 1), method: :post do %>
                  <i class="fa-solid fa-angles-up fa-xl" style="color: #1eb428;"></i>
                <% end %>
              </div>
              <small class="text-align-center font-weight-bold"> <%= app.total_votes %> </small>
              <div class="down text-center mt-1">
                <%#= link_to app_votes_path(app, vote: -1), data: { turbo_method: :post } do %>
                <%= button_to app_votes_path(app, vote: -1), method: :post do %>
                  <i class="fa-solid fa-angles-down fa-xl" style="color: #c40e0e;"></i>
                <% end %>
              </div>
            </div>
          </div>

        </div>
      </div>
    <% end %>
  </div>
</div>

</body>
